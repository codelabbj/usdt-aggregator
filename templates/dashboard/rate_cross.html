{% extends "base.html" %}
{% block title %}Ajustement de taux croisé - Dashboard{% endblock %}
{% block content %}
<div class="page-header">
  <h1>Ajustement de taux croisé</h1>
  <p>Liste des ajustements taux croisé. Le taux affiché est calculé pour la paire (source → cible). Modifier, supprimer ou ajouter un ajustement.</p>
</div>

{% if messages %}
<ul class="messages">
  {% for message in messages %}
  <li class="message-{{ message.tags }}">{{ message }}</li>
  {% endfor %}
</ul>
{% endif %}

<div class="card">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h2 style="margin: 0; font-size: 1.1rem;">Ajustements croisés</h2>
    <a href="{% url 'dashboard:rate_cross_new' %}" class="btn">Nouvel ajustement croisé</a>
  </div>
  <div class="table-responsive">
    <table class="rate-cross-table">
      <thead>
        <tr>
          <th>Cible</th>
          <th>Source</th>
          <th>Cible</th>
          <th>value_buy</th>
          <th>value_sell</th>
          <th>Taux ex. (1 source = X cible)</th>
          <th>Actif</th>
          <th style="width: 180px;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr>
          <td><code>{{ row.adjustment.target }}</code></td>
          <td>{{ row.from_currency }}</td>
          <td>{{ row.to_currency }}</td>
          <td>{{ row.adjustment.value_buy }}</td>
          <td>{{ row.adjustment.value_sell }}</td>
          <td>{% if row.example_rate is not None %}{{ row.example_rate }}{% else %}—{% endif %}</td>
          <td>{% if row.adjustment.active %}<span class="badge badge-success">Oui</span>{% else %}<span class="badge badge-muted">Non</span>{% endif %}</td>
          <td>
            <a href="{% url 'dashboard:rate_cross_edit' row.adjustment.pk %}" class="btn btn-sm btn-secondary">Modifier</a>
            <form method="post" action="{% url 'dashboard:rate_cross_delete' row.adjustment.pk %}" style="display: inline;" onsubmit="return confirm('Supprimer cet ajustement ?');">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-danger">Supprimer</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" style="color: var(--text-muted); padding: 1.5rem;">Aucun ajustement croisé. Cliquez sur « Nouvel ajustement croisé » pour en créer un.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<style>
.rate-cross-table { font-size: 0.85rem; }
.rate-cross-table th, .rate-cross-table td { padding: 0.5rem 0.75rem; }
.rate-cross-table code { font-size: 0.85em; }
.btn-danger { background: var(--error); color: #fff; border: none; }
.btn-danger:hover { filter: brightness(1.1); }
.messages { list-style: none; padding: 0; margin: 0 0 1rem 0; }
.message-success { color: var(--success); background: var(--success-bg); padding: 0.5rem 1rem; border-radius: var(--radius-sm); margin-bottom: 0.25rem; }
.message-error { color: var(--error); background: var(--error-bg); padding: 0.5rem 1rem; border-radius: var(--radius-sm); margin-bottom: 0.25rem; }
.badge { font-size: 0.8rem; padding: 0.2rem 0.5rem; border-radius: 4px; }
.badge-success { background: var(--success-bg); color: var(--success); }
.badge-muted { background: #e2e8f0; color: var(--text-muted); }
</style>
{% endblock %}
